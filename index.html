<!DOCTYPE html>
<html lang="en" ng-app="PathOfDamage">
<head>
  <meta charset="UTF-8">
  <title>Path of Damage</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
  <script src="libs/lz-string.min.js"></script>
  <script src="app.js"></script>
  <script src="DataService.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
</head>
<body ng-controller="Damage">
<div class="background">
  <div class="header">
    <div class="title">Path of Damage</div>
    <div>The Path of Exile physical hit damage calculator</div>
  </div>
  <div class="input">
    <div class="section" ng-repeat="(sectionName, section) in sections">
      <h4>{{section.name}}<br>
        <small><i>{{section.description}}</i></small>
      </h4>
      <div class="tableContainer" ng-if="section.armor !== undefined || section.charges !== undefined">
        <label ng-if="section.armor !== undefined" class="control-label">Armor:
          <input class="form-control input-sm" type="number" ng-model="section.armor" ng-model-options="{debounce: 500}"
                 id="armor" ng-change="updateDamageValues()">
        </label>

        <label ng-if="section.charges !== undefined" class="control-label">Endurance Charges:
          <input class="form-control input-sm" type="number" ng-model="section.charges"
                 ng-model-options="{debounce: 500}" id="charges" ng-change="updateDamageValues()">
        </label>
      </div>
      <div class="tableContainer" ng-repeat="(tableName, table) in section.tables">
        <div class="tableTitle">{{table.totalName}}</div>
        <table class="table table-condensed">
          <tr ng-repeat="value in table.values track by $index">
            <td>
              <input type="checkbox" ng-model="value.enabled" ng-change="updateTotal(table)">
            </td>
            <td class="name">
              <input class="form-control input-sm" type="text" placeholder={{table.placeholder}} ng-model="value.name"
                     ng-change="add(table)" ng-model-options="{debounce: 500}">
            </td>
            <td class="percent">
              <div class="input-group">
                <input class="form-control input-sm" type="number" placeholder="+/-" ng-model="value.value"
                       ng-change="add(table)" ng-model-options="{debounce: 500}" ng-attr-id="{{tableName}}">
                <div ng-if="tableName !== 'flat'" class="input-group-addon">%</div>
                <div ng-if="tableName == 'flat'" class="input-group-addon flat" ng-click="inverse(table, $index)"
                     unselectable="on" onselectstart="return false;" onmousedown="return false;">
                  +/-
                </div>
              </div>
            </td>
            <td>
              <div class="buttonContainer">
                <button ng-if="!$last" class="btn btn-danger btn-sm" ng-click="delete(table, $index)">X</button>
              </div>
            </td>
          </tr>
        </table>
        <div class="total" ng-if="table.values.length > 1">
          Total: <b>{{table.total}}{{tableName !== 'flat' ? '%' : ''}}</b>
        </div>
      </div>
      <hr class="borderLine">
    </div>
  </div>
</div>

<div class="damageTable">
  <table class="table table-bordered table-striped">
    <tr>
      <th>Physical Hit</th>
      <th>Damage Taken</th>
    </tr>
    <tr ng-repeat="hit in hits track by $index">
      <td class="damageInput">
        <input class="form-control input-sm" type="number" ng-model="hits[$index].hit"
               ng-model-options="{debounce: 500}" ng-change="updateHitRow($index)">
      </td>
      <td class="damageOutput"><span class="taken">{{hit.taken}}</span>
        <div class="healthBarContainer">
          <div class="health bar" ng-style="getBarWidth(hit.remaining)"></div>
          <div class="physical bar" ng-style="getBarWidth(hit.taken)"></div>
        </div>
        <div class="tooltip">
          Phys Damage Taken: {{hit.taken-hit.shifted}} <br/>
          Ele Damage Taken: {{hit.shifted}} <br/>
          Damage Mitigated: {{hit.hit-hit.taken}} <br/>
          Health Remaining: {{hit.remaining}}
        </div>
      </td>
    </tr>
  </table>
  <label class="control-label">Elemental Resistance:
    <input class="form-control input-sm" type="number" ng-model="resistance" ng-model-options="{debounce: 500}"
           id="resistance" ng-change="updateDamageValues()">
  </label>
  <label class="control-label">Health and ES Pool:
    <input class="form-control input-sm" type="number" ng-model="healthPool" ng-model-options="{debounce: 500}"
           id="health" ng-change="updateDamageValues()">
  </label>
</div>
</body>
</html>
